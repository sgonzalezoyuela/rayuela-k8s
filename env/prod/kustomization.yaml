apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Rayuela Production Environment
# Deploy: kubectl apply -k env/prod
# Namespace: rayuela

namespace: rayuela

resources:
  - namespace.yaml
  - ../../base
  - sealed-secrets/secrets.yaml
  - sealed-secrets/backup-secrets.yaml
  - backup

patches:
  # App image and pull policy for prod
  - path: patches/app-image.yaml
    target:
      kind: Deployment
      name: rayuela
  
  # Prod resource limits (larger, more replicas)
  - path: patches/resources.yaml
    target:
      kind: Deployment
      name: rayuela

  # Prod database storage (larger)
  - path: patches/db-storage.yaml
    target:
      kind: StatefulSet
      name: rayuela-db

  # Prod-specific configuration
  - path: patches/configmap.yaml
    target:
      kind: ConfigMap
      name: rayuela-config

configMapGenerator:
  # Production SQL seed data files
  - name: rayuela-sql-data
    files:
      - sql/central-data.sql
      - sql/cargos-data.sql
      - sql/conceptos-data.sql
      - sql/tenant1-data.sql
      - sql/tenant2-data.sql

labels:
  - pairs:
      environment: prod
    includeSelectors: false

commonAnnotations:
  rayuela.grex.com.ar/environment: "production"
  rayuela.grex.com.ar/domain: "rayuela.grex.com.ar"
